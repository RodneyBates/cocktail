# $Id: Makefile,v 2.6 1992/09/24 13:14:46 grosch rel $
ifndef INSTALLGMD
  INSTALLGMD=/usr/local
endif
export INSTALLGMD

INSTALLLIB	= $(INSTALLGMD)/lib
INSTALLBIN	= $(INSTALLGMD)/bin
MC	= mocka_mtc

MAKEINCLUDE = .

MLIB	= ../../reuse/gen
FRONT	= ../../front/gen
MOCKALIBS = -d $(FRONT) -d $(MLIB)
MOCKAFLAGS	= -noindex -norange

PLIB	= ParserDrv.mi Parser.md Parser.mi Errors.md Errors.mi \
          Scanner.md Scanner.mi ParserDrv.c Parser.c Parser.h \
          Errors.c Errors.h Scanner.c Scanner.h \
          lalr.cat lalr.syn
PLIBD = $(patsubst %,../lib/%,$(PLIB)) 

MODULADEFS = ArgCheck.md Automaton.md  \
                Check.md Compress.md  \
                Continue.md Debug.md \
                Default.md Final.md Gen.md \
                GenLang.md Infos.md LR.md \
                Lookahead.md Reduce.md 

MODULAIMPS = ArgCheck.mi Automaton.mi \
                Check.mi Compress.mi \
                Continue.mi Debug.mi \
                Default.mi Final.mi Gen.mi \
                GenLang.mi Infos.mi LR.mi \
                Lookahead.mi Reduce.mi lalr.mi

OTHERSOURCES = 
SOURCES = $(MODULASOURCES) $(OTHERSOURCES)


MODULAGENS    =
OTHERGENS    =
GENS    = $(MODULAGENS) $(OTHERGENS)
EXE     = lalr

include $(MAKEINCLUDE)/make.include

compiledefs :
	for file in $(MODULADEFS); do echo $$file; mocka $(MOCKAFLAGS) -s `basename $$file .md`; done

deflinks :
	for file in $(MODULADEFS); do ln -sf $$file `basename $$file .md`.def; done

impmods : implinks compileimps
compileimps :
	for file in $(MODULAIMPS); do echo $$file; mocka $(MOCKAFLAGS) -c `basename $$file .mi`; done

implinks :
	for file in $(MODULAIMPS); do ln -sf $$file `basename $$file .mi`.mod; done



install_modula:

install_mocka:

#install_modula:	lalr lalr.sh $(INSTALLLIB)/lalr $(PLIBD)
#	if test $(INSTALLLIB) = $(INSTALLBIN); then echo error: INSTALLBIN = INSTALLLIB; false; else true; fi
#	sed 's;LIB;$(INSTALLLIB);' < lalr.sh > $(INSTALLBIN)/lalr
#	chmod a+rx $(INSTALLBIN)/lalr
#	install -c -s -m 755 lalr $(INSTALLLIB)/lalr
#	cp $(PLIBD) $(INSTALLLIB)/lalr
#	cd $(INSTALLLIB)/lalr; chmod a+r $(PLIB)

# installation directories

$(INSTALLLIB)/lalr:	$(INSTALLLIB)
	sh -c "if test ! -d $(INSTALLLIB)/lalr; then mkdir $(INSTALLLIB)/lalr; else true; fi"

clean:
	rm -f core *.[dimor] ERRORS LISTING _Debug $(GENS)

.SUFFIXES:	.def .mod .md .mi

.md.def:
	ln $*.md $*.def

.mi.mod:
	ln $*.mi $*.mod

